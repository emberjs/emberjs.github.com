
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ember.js - Stabilizing Ember Data</title>
    <link rel="shortcut icon" href="/images/favicon.png" />
    <link href="/stylesheets/site.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://emberjs.com/blog/feed.xml" rel="alternate" type="application/atom+xml" title="Ember.js - Blog" />

    <script type="text/javascript">
      var _gaq = _gaq || [];
      var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
      _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
      _gaq.push(['_setAccount', 'UA-27675533-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.bxSlider.min.js"></script>

    <script type="text/javascript">
      $(function() {
        var backToTop = $('#back-to-top');
        var doc = $(document);
        var offset = backToTop.offset();
        var marginTop = 90;
        var showing = false;

        positionBackToTop = function(reset) {
          if (reset) {
            backToTop.css({
              top: '',
              position: ''
            });
            offset = backToTop.offset();
          }

          if (!showing && doc.scrollTop() > offset.top+200) {
            showing = true;
            backToTop.css({
              position: 'fixed',
              top: 20,
              left: offset.left,
              display:' block'
            });
          } else if (showing && doc.scrollTop() <= offset.top+200) {
            showing = false;
            backToTop.css({
              display:'none'
            });
          }
        };

        if (backToTop.length) {
          backToTop.on('click', function(evt) {
            $('html,body').animate({scrollTop: 0}, 200);
            return false;
          });

          doc.on('scroll', function() {
            positionBackToTop();
          });
        }

        $('.bx-wrapper, .bx-window').width(940);
      });
    </script>

    
  </head>

  <body class="blog blog_2013 blog_2013_03 blog_2013_03_22 blog_2013_03_22_stabilizing-ember-data">
    <div id="header">
      <div id="wrapper">
        <a id="logo" href="/">&nbsp;</a>
        <ul id="nav">
          <li><a href="/about">about</a></li>
          <li><a href="/guides">guides</a></li>
          <li><a href="/api">api</a></li>
          <li><a href="/community">community</a></li>
          <li class="active"><a href="/blog">blog</a></li>

          <li id="search">
            <form>
              <input type="text" id="st-search-input" class="st-search-input" />
            </form>
            <div id="st-results-container"></div>
            <script type="text/javascript">
              var Swiftype = window.Swiftype || {};
              (function() {
                Swiftype.key = 'HTNahKf4xmo8GgFbTz4n';
                Swiftype.inputElement = '#st-search-input';
                Swiftype.resultContainingElement = '#st-results-container';
                Swiftype.attachElement = '#st-search-input';
                Swiftype.renderStyle = "overlay";

                var script = document.createElement('script');
                script.type = 'text/javascript';
                script.async = true;
                script.src = "//swiftype.com/embed.js";
                var entry = document.getElementsByTagName('script')[0];
                entry.parentNode.insertBefore(script, entry);
              }());
            </script>
          </li>

        </ul>

        <div id="github">
          <a href="https://github.com/emberjs/ember.js"><img src="/images/fork-us.png">Fork Us!</a>
        </div>
      </div>
    </div>

    <div id="content-wrapper">
      
      
        <div id="sidebar">
          <ol id='toc-list'>
  
  <li class='level-1'>
    <a href="/blog/tags/recent-posts.html">Recent Posts</a>
    <ol style="display:block">
      
      <li class='level-3'><a href="/blog/2013/05/28/ember-data-0-13.html">Ember Data 0.13</a></li>
    
      <li class='level-3'><a href="/blog/2013/05/28/ember-1-0-rc4.html">Ember 1.0 RC4</a></li>
    
      <li class='level-3'><a href="/blog/2013/05/03/ember-data-progress-update.html">Ember Data Progress Update</a></li>
    
      <li class='level-3'><a href="/blog/2013/04/21/ember-1-0-rc3.html">Ember 1.0 RC3</a></li>
    
      <li class='level-3'><a href="/blog/2013/04/05/announcing-the-ember-security-policy.html">Announcing the Ember.js Security Policy</a></li>
    
      <li class='level-3'><a href="/blog/2013/03/30/ember-1-0-rc2.html">Ember 1.0 RC2</a></li>
    
      <li class='level-3'><a href="/blog/2013/03/22/stabilizing-ember-data.html">Stabilizing Ember Data</a></li>
    
      <li class='level-3'><a href="/blog/2013/03/21/making-ember-easier.html">Making Ember.js Easier</a></li>
    
    </ol>
  </li>
  
  <li class='level-1'>
    <a href="/blog/tags/releases.html">Releases</a>
    <ol style="display:block">
      
      <li class='level-3'><a href="/blog/2013/05/28/ember-data-0-13.html">Ember Data 0.13</a></li>
    
      <li class='level-3'><a href="/blog/2013/05/28/ember-1-0-rc4.html">Ember 1.0 RC4</a></li>
    
      <li class='level-3'><a href="/blog/2013/04/21/ember-1-0-rc3.html">Ember 1.0 RC3</a></li>
    
      <li class='level-3'><a href="/blog/2013/03/30/ember-1-0-rc2.html">Ember 1.0 RC2</a></li>
    
      <li class='level-3'><a href="/blog/2013/02/15/ember-1-0-rc.html">Ember 1.0 RC</a></li>
    
      <li class='level-3'><a href="/blog/2012/10/25/ember-1-0-pre2.html">Ember 1.0 Prerelease 2</a></li>
    
      <li class='level-3'><a href="/blog/2012/08/03/ember-1-0-prerelease.html">Ember 1.0 Prerelease</a></li>
    
    </ol>
  </li>
  <li class='level-1'>
    <a href="/blog/tags/this-week-in-ember.html">This Week in Ember</a>
    <ol style="display:block">
      
      <li class='level-3'><a href="/blog/2013/01/18/this-week-in-ember-js-4.html">January 18, 2013</a></li>
    
      <li class='level-3'><a href="/blog/2012/12/22/this-week-in-ember-js-3.html">December 22, 2012</a></li>
    
      <li class='level-3'><a href="/blog/2012/12/02/this-week-in-ember-js-2.html">December 02, 2012</a></li>
    
      <li class='level-3'><a href="/blog/2012/11/02/this-week-in-ember-js.html">November 02, 2012</a></li>
    
    </ol>
  </li>
</ol>

          <div id="back-to-top"><a id="back-top-top" href="#">&#11014; Back to Top</a></div>
        </div>
      
      <div id="content" class="has-sidebar">
          <article class="blog-post">
    <h1>Stabilizing Ember Data</h1>
    
      <h3 class="blog-post-author">Posted By: Tom Dale & Yehuda Katz &ndash; <time>Mar 22, 2013</time></h3>
    

    <p>Yesterday, we gave you an update on our progress making Ember.js easier
to use. One thing we didn&#39;t discuss was our plan for Ember Data.</p>

<p>It&#39;s no secret that, while many developers are building awesome apps
with Ember.js, Ember Data still causes lots of frustration due to bugs
and a changing, complex API. Documentation about it is also mixed in
with Ember.js documentation, making it difficult for new developers to
understand what is stable and what is not.</p>

<p>To be clear, Ember Data is not a dependency of Ember.js.
<a href="https://github.com/discourse/discourse">Discourse</a>, for example, uses
its own, simple wrapper around
<a href="https://github.com/discourse/discourse/blob/master/app/assets/javascripts/discourse/models/model.js"><code>$.ajax</code></a>.</p>

<p>Even though Ember Data is not a dependency of Ember.js, loading data
from the server is an extremely important part of most web applications,
and it&#39;s a problem that every Ember.js application will have to deal
with.</p>

<p>Our long-term goal is simple: we don&#39;t think most web developers should
have to write any custom XHR code for loading data. Strong conventions
on the client and strong conventions on the server should allow them to
communicate automatically.</p>

<p>We know we&#39;re not there yet.</p>

<p>In order for this to work, there are many necessary features that must
be rock-solid across all sorts of different persistence layersâ€”local
storage, relational databases, and key-value stores, to name a few. To
top it off, the asynchronous environment of the browser (with an often
unreliable internet connection) adds significant complexity, and means
we can&#39;t simply port the solutions to these problems that have been
pioneered on the server.</p>

<p>Getting all of these features working well together is a challenging
problem, and we have not been able to deliver everything we thought we
could in a reasonable amount of time.</p>

<p>Additionally, many developers are writing web applications that need to
consume an existing JSON API that evolved organically and is not
consistently named or structured. The API we have provided so far is
suboptimal for this task.</p>

<p>To make the experience of writing an Ember Data application less
frustrating, we&#39;re doing two things:</p>

<ol>
<li>We&#39;re identifying a subset of features that already work reliably.</li>
<li>We&#39;re introducing a new, simpler API for working with remote data
that makes fewer assumptions. You still get to use the model API
in Ember Data, but can &quot;bring your own <code>$.ajax</code>&quot; to load and store
records.</li>
</ol>

<p>Right now, what gets documented is somewhat ad-hoc. Going forward, we
will heavily document the stable features. Finding documentation about
an Ember Data feature on the emberjs.com website will be your indication
that we consider it stable and safe to use.</p>

<p>Over time, after we have put new features through their paces and
written extensive documentation, the set of stable features will grow.
In other words, we are refocusing on a small core of practical features,
which we will slowly iterate towards our long-term, ambitious goal.</p>
<h2 class='anchorable-toc' id='toc_the-basic-adapter'>The Basic Adapter</h2>
<p>The Ember Data adapter layer, which is responsible for finding and
saving records, is currently designed to make it easy to build reusable
adapters, like the ones people have written for
<a href="https://github.com/clintjhill/ember-parse-adapter">Parse</a> or
<a href="https://github.com/pangratz/ember-couchdb-adapter">CouchDB</a>. It is not
well-suited for delegating out to <code>$.ajax</code> to work with an API
that is not 100% consistent.</p>

<p>To make it easier to use Ember Data with any kind of JSON data, we
are introducing the Basic Adapter, which simply delegates to a <code>sync</code>
object on your model.</p>

<p>Let&#39;s look at an example of using the Basic Adapter with the Twitter API.</p>

<p>First, note that the syntax for defining a model hasn&#39;t changed
(historically, this has been one of the most stable parts of Ember
Data):</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
22
23
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> attr = DS.attr, hasMany = DS.hasMany, belongsTo = DS.belongsTo;

App.User = DS.Model.extend({
  <span class="key">defaultProfileImage</span>: attr(<span class="string"><span class="delimiter">'</span><span class="content">boolean</span><span class="delimiter">'</span></span>),
  <span class="key">description</span>: attr(<span class="string"><span class="delimiter">'</span><span class="content">string</span><span class="delimiter">'</span></span>),
  <span class="key">screenName</span>: attr(<span class="string"><span class="delimiter">'</span><span class="content">string</span><span class="delimiter">'</span></span>),
  <span class="key">isVerified</span>: attr(<span class="string"><span class="delimiter">'</span><span class="content">boolean</span><span class="delimiter">'</span></span>),
  <span class="key">createdAt</span>: attr(<span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>),

  <span class="key">tweets</span>: hasMany(<span class="string"><span class="delimiter">'</span><span class="content">App.Tweet</span><span class="delimiter">'</span></span>)
});

App.Tweet = DS.Model.extend({
  <span class="key">coordinates</span>: attr(<span class="string"><span class="delimiter">'</span><span class="content">point</span><span class="delimiter">'</span></span>),
  <span class="key">createdAt</span>: attr(<span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>),
  <span class="key">isFavorited</span>: attr(<span class="string"><span class="delimiter">'</span><span class="content">boolean</span><span class="delimiter">'</span></span>),
  <span class="key">retweetCount</span>: attr(<span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span>),
  <span class="key">text</span>: attr(<span class="string"><span class="delimiter">'</span><span class="content">string</span><span class="delimiter">'</span></span>),
  <span class="key">isTruncated</span>: attr(<span class="string"><span class="delimiter">'</span><span class="content">boolean</span><span class="delimiter">'</span></span>),

  <span class="key">replyTo</span>: belongsTo(<span class="string"><span class="delimiter">'</span><span class="content">App.User</span><span class="delimiter">'</span></span>),
  <span class="key">user</span>: belongsTo(<span class="string"><span class="delimiter">'</span><span class="content">App.User</span><span class="delimiter">'</span></span>)
});
</pre></td>
</tr></table>
</div></div>
<p>Finding records also hasn&#39;t changed:</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre><span class="comment">// use the Promise API</span>
App.User.find(userId).then(<span class="keyword">function</span>(user) {
  <span class="keyword">return</span> user.get(<span class="string"><span class="delimiter">'</span><span class="content">tweets</span><span class="delimiter">'</span></span>);
}).then(<span class="keyword">function</span>(tweets) {
  <span class="comment">// do something with `tweets`</span>
});
</pre></td>
</tr></table>
</div></div>
<p>When you request the <code>User</code> and then its <code>tweets</code>, Ember Data will make
calls to your models&#39; <code>sync</code> object.</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
22
23
24
25
26
27
</pre></td>
  <td class="code"><pre>App.User.sync = {
  <span class="function">find</span>: <span class="keyword">function</span>(id, process) {
    <span class="predefined">$</span>.getJSON(<span class="string"><span class="delimiter">&quot;</span><span class="content">/users/show</span><span class="delimiter">&quot;</span></span>, { <span class="key">screen_name</span>: id }).then(<span class="keyword">function</span>(user) {        
      process(user)                 
        .primaryKey(<span class="string"><span class="delimiter">'</span><span class="content">screen_name</span><span class="delimiter">'</span></span>)
        .camelizeKeys()
        .applyTransforms(<span class="string"><span class="delimiter">'</span><span class="content">twitter</span><span class="delimiter">'</span></span>)
        .load();
    });
  },

  <span class="function">findTweets</span>: <span class="keyword">function</span>(user, name, process) {
    <span class="keyword">var</span> screenName = user.get(<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>);

    <span class="predefined">$</span>.getJSON(<span class="string"><span class="delimiter">&quot;</span><span class="content">/statuses/user_timeline</span><span class="delimiter">&quot;</span></span>, { <span class="key">screen_name</span>: screenName }).then(<span class="keyword">function</span>(timeline) {
      process(timeline)
        .primaryKey(<span class="string"><span class="delimiter">'</span><span class="content">id_str</span><span class="delimiter">'</span></span>)
        .camelizeKeys()
        .applyTransforms(<span class="string"><span class="delimiter">'</span><span class="content">twitter</span><span class="delimiter">'</span></span>)
        .munge(<span class="keyword">function</span>(json) {
          json.isTruncated = json.truncated;
          json.replyTo = json.inReplyToScreenName;
        })
        .load();
    });
  }
};
</pre></td>
</tr></table>
</div></div>
<p>As you can see, in each of the hooks on the <code>sync</code> object, the last
argument passed in is a function called <code>process</code>. You use this function to
load JSON data returned from the XHR into the store. It also includes
several conveniences for common transformations, like camelizing
property names and transforming values like dates.</p>

<p>Of course, you are not required to use these conveniences. You can write
whatever imperative code you&#39;d like to transform the JSON returned from
the server into the form that Ember Data is expecting. Here is the above
example re-written without using the chained conveniences.</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers" title="double click to toggle" ondblclick="with (this.firstChild.style) { display = (display == '') ? 'none' : '' }"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
<strong>20</strong>
21
22
23
24
25
26
27
28
29
<strong>30</strong>
31
</pre></td>
  <td class="code"><pre><span class="function">findTweets</span>: <span class="keyword">function</span>(user, name, process) {
  <span class="keyword">var</span> screenName = user.get(<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>);

  <span class="predefined">$</span>.getJSON(<span class="string"><span class="delimiter">&quot;</span><span class="content">/statuses/user_timeline</span><span class="delimiter">&quot;</span></span>, { <span class="key">screen_name</span>: screenName }).then(<span class="keyword">function</span>(timeline) {
    <span class="keyword">var</span> tweets = timeline.map(<span class="keyword">function</span>(json) {
      <span class="comment">// Map primary key</span>
      json.id = json.id_str;

      <span class="comment">// Camelize property names</span>
      <span class="keyword">for</span> (<span class="keyword">var</span> prop <span class="keyword">in</span> json) {
        <span class="keyword">var</span> value = json[prop];
        <span class="keyword">delete</span> json[prop];
        json[camelize(prop)] = value;
      }

      <span class="comment">// Convert string-formatted date to object</span>
      json.createdAt = Date.parse(json.createdAt);

      <span class="comment">// Convert hash to JavaScript object</span>
      json.coordinates = <span class="keyword">new</span> Twitter.Point(json.coordinates);

      <span class="comment">// Rename properties</span>
      json.isTruncated = json.truncated;
      json.replyTo = json.inReplyToScreenName;

      <span class="keyword">return</span> json;
    });

    process(tweets).load();
  });
}
</pre></td>
</tr></table>
</div></div><h2 class='anchorable-toc' id='toc_timeline'>Timeline</h2>
<p>We have been working on this new API part-time for the past few weeks.
You can see our progress on Ember Data&#39;s master branch, by looking at
<a href="https://github.com/emberjs/data/tree/master/packages/ember-data/tests/integration/adapters/basic_adapter">the tests</a> or <a href="https://github.com/emberjs/data/blob/master/packages/ember-data/lib/adapters/basic_adapter.js">the implementation</a>.</p>

<p>Over the next few weeks, we will be writing documentation that will be
available in the <a href="http://emberjs.com/guides/">Ember.js Guides</a>. Once a
few people have had the opportunity to use the Basic Adapter and
sanity-check our work, we will start cutting beta releases of Ember
Data. We think that this will be a lot easier for new developers than &quot;make
a build from master.&quot;</p>

<p>Our thanks go out to <a href="http://mcdowall.info">John McDowall</a>, who has been
tracking our progress on Basic Adapter and writing documentation to go
with it.</p>

<p>Finally, we&#39;d like to give a big thanks to
<a href="https://addepar.com/">Addepar</a> for financially supporting us
while we do this work. They are big users of and contributors to Ember
Data, and we couldn&#39;t do it without them.</p>


    <hr>

    <div id="disqus_thread"></div> 
    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'emberblog'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </article>

      </div>
    </div>

    <div id="footer">
      <div id="footer-wrapper">
        <div class="info">
          Copyright 2013 <a href="http://tilde.io">Tilde Inc.</a><br>
          Design by <a href="http://www.heropixel.com">HeroPixel</a></br>
          <a href="/team">Core Team</a> | <a href="/sponsors">Project Sponsors</a>
        </div>
        <div class="statement">Ember.js is free, open source and always will be.</div>
        <div class="links">
          <a class="twitter" href="http://twitter.com/emberjs">Twitter</a>
          <a class="github" href="https://github.com/emberjs/ember.js">GitHub</a>
          <a class="googleplus" href="https://plus.google.com/communities/106387049790387471205">Google+</a>
        </div>
      </div>
    </div>
  </body>
</html>
